@page "/TaskLog/Details/{id:int}"

@using BlazorApp1.Models
@using MudBlazor
@using BlazorApp1.Components.DynamicTable
@inherits TaskLogDetailsBase

<link href="css/TaskLog/TaskLogDetails.css" rel="stylesheet" />

<!-- ─────────────ــ بدنه صفحه ــ───────────── -->
<MudContainer MaxWidth="MaxWidth.Medium"
              Class="details-container py-10">

    @* ───── در صورت نبود Activity انتخاب‌شده ───── *@
    @if (ActivityState.SelectedActivity is null)
    {
        <MudText Typo="Typo.h6" Color="Color.Error" Align="Align.Center" Class="mb-6">
            فعّالیّتی یافت نشد!
        </MudText>

        <div class="center-flex">
            <MudButton Variant="Variant.Filled"
                       Color="Color.Primary"
                       StartIcon="@Icons.Material.Filled.ArrowBack"
                       OnClick="GoBack">
                بازگشت
            </MudButton>
        </div>
    }
    else
    {
        @* ───── هِدر ───── *@
        <MudGrid AlignItems="Center" Class="details-header" Spacing="2">

            <!-- Back -->
            <MudItem xs="4" Class="center-flex">
                <MudIconButton Icon="@Icons.Material.Filled.ArrowBack"
                               Color="Color.Error"
                               Size="Size.Medium"
                               OnClick="GoBack" />
            </MudItem>

            <!-- Total time -->
            <MudItem xs="4" Class="d-flex flex-column align-center">
                <MudText Typo="Typo.subtitle2" Class="header-label">زمان صرف‌شده</MudText>
                <MudChip T="string" Color="Color.Primary"
                         Variant="Variant.Filled" Class="header-chip">
                    @FormatTime(ActivityState.SelectedActivity.TotalSeconds)
                </MudChip>
            </MudItem>

            <!-- Title -->
            <MudItem xs="4" Class="d-flex justify-end">
                <MudText Typo="Typo.h6" Align="Align.Right" Class="activity-title">
                    @ActivityState.SelectedActivity.Title
                </MudText>
            </MudItem>
        </MudGrid>

        @* ───── فرم رکورد جدید ───── *@
        <MudPaper Class="tasklogdetails-form-glass mb-8" Elevation="0">
            <MudGrid GutterSpacing="3"
                     AlignItems="Center"
                     Class="form-grid"
                     Breakpoint="Breakpoint.Sm">

                <!-- Start | Stop -->
                <MudItem xs="12" md="3" Class="btn-wrapper">
                    <MudButton Color="@(_isRunning ? Color.Error : Color.Success)"
                               Variant="Variant.Filled"
                               OnClick="ToggleTimer"
                               Class="action-btn start-stop-btn">
                        @(_isRunning ? "توقف" : "شروع")
                    </MudButton>
                </MudItem>

                <!-- Timer -->
                <MudItem xs="12" md="2" Class="timer-wrapper">
                    <MudPaper Class="timer-box" Elevation="0">
                        <MudText Typo="Typo.h5" Class="timer-text">
                            @FormatTime(_seconds)
                        </MudText>
                    </MudPaper>
                </MudItem>

                <!-- Record title -->
                <MudItem xs="12" md="4" Class="center-flex">
                    <MudTextField T="string"
                                  Label="عنوان رکورد"
                                  @bind-Value="_recordTitle"
                                  Variant="Variant.Outlined"
                                  FullWidth="true"
                                  Class="modern-input" />
                </MudItem>

                <!-- Save -->
                <MudItem xs="12" md="3" Class="btn-wrapper">
                    <MudButton Color="Color.Primary"
                               Variant="Variant.Filled"
                               Disabled="_isRunning"
                               OnClick="SaveRecord"
                               Class="action-btn save-btn">
                        ذخیره
                    </MudButton>
                </MudItem>

            </MudGrid>
        </MudPaper>

        @* ───── جدول رکوردها ───── *@
        <div class="records-wrap">
            <DynamicTable Items="_records" Columns="RecordColumns" />
        </div>
    }
</MudContainer>

@page "/TaskLog"
@using BlazorApp1.Models
@using MudBlazor
@using BlazorApp1.Components.TrackerWidgets

@inherits TaskLogPageBase

<link href="css/TaskLog/TaskLogPage.css" rel="stylesheet" />

<MudContainer MaxWidth="MaxWidth.Medium" Class="py-12">
    <MudText Typo="Typo.h4" Align="Align.Center" Color="Color.Primary" Class="mb-8">
        لیست فعالیت‌ها
    </MudText>

    <!-- فرم افزودن فعالیت -->
    <MudPaper Class="p-4 mb-8 tasklog-form">
        <MudGrid GutterSpacing="3" AlignItems="AlignItems.Center">
            <MudItem xs="12" md="6">
                <MudTextField T="string"
                              @bind-Value="newTitle"
                              Label="عنوان فعالیت"
                              Variant="Variant.Outlined"
                              FullWidth="true"
                              InputClass="text-end"
                              Immediate="true"
                              Error="@showTitleError"
                              ErrorText="عنوان الزامی است" />
            </MudItem>
            <MudItem xs="6" md="3">
                <MudTextField T="string"
                              @bind-Value="newTime"
                              Placeholder="00:00:00"
                              Variant="Variant.Outlined"
                              Label="مدت زمان"
                              FullWidth="true"
                              InputClass="text-center" />
            </MudItem>
            <MudItem xs="6" md="3" Class="d-flex align-items-center">
                <MudButton Color="Color.Primary"
                           Variant="Variant.Outlined"
                           StartIcon="@Icons.Material.Filled.Add"
                           OnClick="AddActivity"
                           Size="Size.Small"
                           Class="w-100 px-0 py-1 rounded-3">
                    افزودن
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>

    @if (loading)
    {
        <MudProgressCircular Indeterminate="true"
                             Color="Color.Primary"
                             Class="d-block mx-auto my-10" />
    }
    else
    {
        <MudPaper Elevation="1">
            <ActivityTable Items="activities"
                           OnEdit="OpenEditModal"
                           OnDelete="OpenDelete"
                           OnDetails="NavigateToDetails"
                           ShowDetailsIcon="true" />
        </MudPaper>
    }
</MudContainer>

<!-- دیالوگ ویرایش فعالیت -->
<MudDialog @bind-Visible="editOpen" MaxWidth="MaxWidth.Small">
    <DialogContent>
        <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">ویرایش فعالیت</MudText>
        <MudTextField T="string"
                      @bind-Value="editTitle"
                      Label="عنوان جدید"
                      Variant="Variant.Outlined"
                      Immediate="true"
                      Error="@editShowTitleError"
                      ErrorText="عنوان الزامی است" />
        <MudTextField T="string"
                      @bind-Value="editTime"
                      Placeholder="00:00:00"
                      Variant="Variant.Outlined"
                      Label="مدت زمان"
                      Immediate="true"
                      InputClass="text-center" />
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Default"
                   Variant="Variant.Text"
                   Size="Size.Small"
                   OnClick="() => editOpen = false">
            لغو
        </MudButton>
        <MudButton Color="Color.Primary"
                   Variant="Variant.Filled"
                   Size="Size.Small"
                   OnClick="SaveEdit">
            ذخیره
        </MudButton>
    </DialogActions>
</MudDialog>

<!-- دیالوگ حذف -->
<ConfirmDialog @bind-Open="deleteOpen"
               Message="آیا مطمئن هستید که این فعالیت حذف شود؟"
               ConfirmText="حذف"
               ConfirmColor="Color.Error"
               OnConfirm="DeleteActivity" />
